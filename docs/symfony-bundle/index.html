<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="/dist/css/vendor.css" />
    <link rel="stylesheet" href="/dist/css/style.css" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.0/styles/dracula.min.css" />
    <script src="https://kit.fontawesome.com/134a4a1c71.js" crossorigin="anonymous"></script>

    <title>Aeon PHP - Symfony Bundle - Documentation</title>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-170080616-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-170080616-1');
    </script>
</head>
<body data-spy="scroll" data-target="#toc">


<section class="py-0">
    <div class="container-fluid">
        <div class="row justify-content-between">

            <!-- navigation -->
            <aside class="col-lg-3 p-3 doc-sidebar">
                <div class="sticky">
                    <nav class="navbar navbar-vertical navbar-expand-lg navbar-light">
    <a href="/" class="navbar-brand"><img src="/dist/images/logo.png" alt="Logo"></a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul id="page-nav" class="nav nav-vertical-2 flex-column">
            <li class="nav-item">
                <a class="nav-link" data-toggle="collapse" href="#getting-started" role="button" aria-expanded="false" aria-controls="menu-1">Getting Started</a>
                <div class="collapse" id="getting-started" data-parent="#page-nav">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="/docs">Introduction</a>
                        </li>
                    </ul>
                </div>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-toggle="collapse" href="#cli" role="button" aria-expanded="false" aria-controls="menu-2">CLI Application</a>
                <div class="collapse" id="cli" data-parent="#page-nav">
                    <div>
                        <ul class="nav flex-column">
                            <li class="nav-item">
                                <a class="nav-link" href="/docs/cli">index</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-toggle="collapse" href="#calendar" role="button" aria-expanded="false" aria-controls="menu-2">Calendar Library</a>
                <div class="collapse" id="calendar" data-parent="#page-nav">
                    <div>
                        <ul class="nav flex-column">
                            <li class="nav-item">
                                <a class="nav-link" href="/docs/calendar">index</a>
                            </li>
                                                            <li class="nav-item">
                                    <a class="nav-link" href="/docs/calendar/1.x">version 1.x</a>
                                </li>
                                                    </ul>
                    </div>
                </div>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-toggle="collapse" href="#calendar-twig" role="button" aria-expanded="false" aria-controls="menu-2">Calendar Twig Library</a>
                <div class="collapse" id="calendar-twig" data-parent="#page-nav">
                    <div>
                        <ul class="nav flex-column">
                            <li class="nav-item">
                                <a class="nav-link" href="/docs/calendar-twig">index</a>
                            </li>
                                                            <li class="nav-item">
                                    <a class="nav-link" href="/docs/calendar-twig/1.x">version 1.x</a>
                                </li>
                                                    </ul>
                    </div>
                </div>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-toggle="collapse" href="#calendar-doctrine" role="button" aria-expanded="false" aria-controls="menu-2">Calendar Doctrine Library</a>
                <div class="collapse" id="calendar-doctrine" data-parent="#page-nav">
                    <div>
                        <ul class="nav flex-column">
                            <li class="nav-item">
                                <a class="nav-link" href="/docs/calendar-doctrine">index</a>
                            </li>
                                                            <li class="nav-item">
                                    <a class="nav-link" href="/docs/calendar-doctrine/1.x">version 1.x</a>
                                </li>
                                                    </ul>
                    </div>
                </div>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-toggle="collapse" href="#retry" role="button" aria-expanded="false" aria-controls="menu-2">Retry Library</a>
                <div class="collapse" id="retry" data-parent="#page-nav">
                    <div>
                        <ul class="nav flex-column">
                            <li class="nav-item">
                                <a class="nav-link" href="/docs/retry">Index</a>
                            </li>
                                                            <li class="nav-item">
                                    <a class="nav-link" href="/docs/retry/1.x">version 1.x</a>
                                </li>
                                                    </ul>
                    </div>
                </div>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-toggle="collapse" href="#sleep" role="button" aria-expanded="false" aria-controls="menu-2">Sleep Library</a>
                <div class="collapse" id="sleep" data-parent="#page-nav">
                    <div>
                        <ul class="nav flex-column">
                            <li class="nav-item">
                                <a class="nav-link" href="/docs/sleep">Index</a>
                            </li>
                                                            <li class="nav-item">
                                    <a class="nav-link" href="/docs/sleep/1.x">version 1.x</a>
                                </li>
                                                    </ul>
                    </div>
                </div>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-toggle="collapse" href="#calendar-holidays" role="button" aria-expanded="false" aria-controls="menu-2">Calendar Holidays Library</a>
                <div class="collapse" id="calendar-holidays" data-parent="#page-nav">
                    <div>
                        <ul class="nav flex-column">
                            <li class="nav-item">
                                <a class="nav-link" href="/docs/calendar-holidays">index</a>
                            </li>
                                                            <li class="nav-item">
                                    <a class="nav-link" href="/docs/calendar-holidays/1.x">version 1.x</a>
                                </li>
                                                    </ul>
                    </div>
                </div>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-toggle="collapse" href="#calendar-holidays-yasumi" role="button" aria-expanded="false" aria-controls="menu-2">Calendar Holidays Yasumi Library</a>
                <div class="collapse" id="calendar-holidays-yasumi" data-parent="#page-nav">
                    <div>
                        <ul class="nav flex-column">
                            <li class="nav-item">
                                <a class="nav-link" href="/docs/calendar-holidays-yasumi">index</a>
                            </li>
                                                            <li class="nav-item">
                                    <a class="nav-link" href="/docs/calendar-holidays-yasumi/1.x">version 1.x</a>
                                </li>
                                                    </ul>
                    </div>
                </div>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-toggle="collapse" href="#business-hours" role="button" aria-expanded="false" aria-controls="menu-2">Business Hours Library</a>
                <div class="collapse" id="business-hours" data-parent="#page-nav">
                    <div>
                        <ul class="nav flex-column">
                            <li class="nav-item">
                                <a class="nav-link" href="/docs/business-hours">index</a>
                            </li>
                                                            <li class="nav-item">
                                    <a class="nav-link" href="/docs/business-hours/1.x">version 1.x</a>
                                </li>
                                                    </ul>
                    </div>
                </div>
            </li>
            <li class="nav-item">
                <a class="nav-link active" data-toggle="collapse" href="#symfony-bundle" role="button" aria-expanded="true" aria-controls="menu-2">Symfony Bundle</a>
                <div class="collapse show" id="symfony-bundle" data-parent="#page-nav">
                    <div>
                        <ul class="nav flex-column">
                            <li class="nav-item">
                                <a class="nav-link" href="/docs/symfony-bundle">index</a>
                            </li>
                                                            <li class="nav-item">
                                    <a class="nav-link" href="/docs/symfony-bundle/1.x">version 1.x</a>
                                </li>
                                                    </ul>
                    </div>
                </div>
            </li>
        </ul>
    </div>
</nav>
                </div>
            </aside>
            <!-- / navigation -->

            <!-- content -->
            <article class="col-lg-9 doc-content">
                <div class="row">
                    <div class="col">
                        <div class="doc-content-header">
                            <div class="row align-items-center">
                                <div class="col-6 col-lg-10">
                                    <nav aria-label="breadcrumb d-none d-inline-flex-lg">
                                                                                    <a href="/" class="breadcrumb-back" title="Back"></a>
                                                                                <ol class="breadcrumb d-none d-lg-inline-flex">
                                            <li class="breadcrumb-item"><a href="/">Home</a></li>
                                            <li class="breadcrumb-item active"><a href="/docs">Documentation</a></li>
                                            <li class="breadcrumb-item active"><a href="https://forum.aeon-php.org">Forum</a></li>
                                        </ol>
                                    </nav>
                                </div>
                                <div class="col text-right">
                                    <a href="https://packagist.org/packages/aeon-php/calendar" class="btn btn-sm btn-rounded btn-primary">Install</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                    <div class="row doc-content-body">
        <article class="col-md-9">
            <section id="calendar-interface">
                <h5 class="section-title-2">Symfony Bundle</h5>
                <hr/>
                Available versions:
                <ul>
                                    <li><a href="/docs/symfony-bundle/1.x">1.x</a></li>
                                </ul>
            </section>
            <section>
                <h3 id="installation">Installation</h3>
                <p>
                    <code class="code">composer require aeon-php/symfony-bundle</code>
                </p>
            </section>
            <section>
                <h3 id="configuration">Configuration</h3>
                <p>

                </p>
                <h5>Register Bundle</h5>
            <pre><code class="language-php">&lt;?php

// AppKernel.php or bundles.php

$bundles = [
    new Aeon\Symfony\AeonBundle\AeonBundle(),
];</code></pre>
                <h5>Configure Bundle</h5>
                <pre><code class="language-yaml"># config/packages/aeon.yaml

aeon:
  calendar_timezone: 'UTC'
  calendar_holidays_factory_service: 'calendar.holidays.factory.google'
  ui_timezone: 'America/Los_Angeles'
  ui_datetime_format: 'Y-m-d H:i:s'
  ui_date_format: 'Y-m-d'
  ui_time_format: 'H:i:s'</code></pre>
            </section>
            <section>
                <h3 id="aeon-symfony-form-types">Aeon Symfony Form Types</h3>
                <ul>
                    <li><code>Aeon\Symfony\AeonBundle\Form\Type\AeonDayType</code></li>
                    <li><code>Aeon\Symfony\AeonBundle\Form\Type\AeonDateTimeType</code></li>
                    <li><code>Aeon\Symfony\AeonBundle\Form\Type\AeonTime</code></li>
                    <li><code>Aeon\Symfony\AeonBundle\Form\Type\AeonTimeZone</code></li>
                </ul>
            </section>
            <section>
                <h3 id="aeon-symfony-validators">Aeon Symfony Validators</h3>
                <ul>
                    <li><code>Aeon\Symfony\AeonBundle\Validator\Constraints\After</code></li>
                    <li><code>Aeon\Symfony\AeonBundle\Validator\Constraints\AfterOrEqual</code></li>
                    <li><code>Aeon\Symfony\AeonBundle\Validator\Constraints\Before</code></li>
                    <li><code>Aeon\Symfony\AeonBundle\Validator\Constraints\BeforeOrEqual</code></li>
                    <li><code>Aeon\Symfony\AeonBundle\Validator\Constraints\Equal</code></li>
                    <li><code>Aeon\Symfony\AeonBundle\Validator\Constraints\Holiday</code></li>
                    <li><code>Aeon\Symfony\AeonBundle\Validator\Constraints\NotHoliday</code></li>
                </ul>
            </section>
            <section>
                <h3 id="current-time">How to get current time in Symfony</h3>
                <p>
                    The easiest, cleanest and most reliable way to get current DateTime in Symfony is to use <a href="/docs/calendar/1.x/gregorian-calendar">Calendar</a>.
                    For example in order to get current time in Symfony Controller use following code (AeonBundle register Calendar as Autowired service).
                </p>
                <h6>Controller</h6>
                <pre><code class="language-php">&lt;?php

namespace App\Controller;

use Aeon\Calendar\Gregorian\Calendar;
use Symfony\Bundle\FrameworkBundle\Controller\AbstractController;
use Symfony\Component\HttpFoundation\Response;
use Symfony\Component\Routing\Annotation\Route;

class AeonCalendarController extends AbstractController
{
    private Calendar $calendar;

    public function __construct(Calendar $calendar)
    {
        $this->calendar = $calendar;
    }

    /**
     * @Route("/aeon/calendar", name="aeon_calendar")
     */
    public function index(): Response
    {
        return $this->render('aeon_calendar/index.html.twig', [
            'calendar' => $this->calendar
        ]);
    }
}</code></pre>
                <h6>Twig</h6>
                <script src="https://gist.github.com/norberttech/ab14611673fb0d61d670df9f6946177e.js"></script>
                            </section>
            <section>
                <h3 id="testing">How to test features that depends on time in Symfony</h3>
                <p>
                    AeonBundle automatically replace GregorianCalendar with  <a href="/docs/calendar/1.x/gregorian-gregoriancalendarstub">GregorianCalendarStub</a> instance
                    in <code>test</code> environment.
                </p>
                <p>
                    Knowing that we must just get the GregorianCalendarStub::class class from the service container (GregorianCalendarStub::class is an alias for Calendar::class) and use <code>setNow</code> method.
                </p>
                <pre><code class="language-php">&lt;?php

namespace App\Tests;

use Aeon\Calendar\Gregorian\DateTime;
use Aeon\Calendar\Gregorian\GregorianCalendarStub;
use Symfony\Bundle\FrameworkBundle\Test\WebTestCase;

class AeonCalendarControllerTest extends WebTestCase
{
    public function testSomething()
    {
        $client = static::createClient();

        $client->getContainer()->get(GregorianCalendarStub::class)->setNow(DateTime::fromString('2020-01-01 00:00:00 America/Los_Angeles'));

        $client->request('GET', '/aeon/calendar');

        $this->assertResponseIsSuccessful();
        $this->assertSelectorTextContains('code#calendar-year', '2020');
        $this->assertSelectorTextContains('code#calendar-month', '2020-01');
        $this->assertSelectorTextContains('code#calendar-day', '2020-01-01');
        $this->assertSelectorTextContains('code#calendar-datetime', '2020-01-01T00:00:00-08:00');
    }
}</code></pre>
            </section>
            <section>
                <h3>How to check in Symfony Form if a given date is a holiday</h3>
                <p>
                    Aeon Symfony Bundle provides two Symfony Validators.
                </p>
                <ul>
                    <li><code>Aeon\Symfony\AeonBundle\Validator\Constraints\Holiday</code></li>
                    <li><code>Aeon\Symfony\AeonBundle\Validator\Constraints\NoyHoliday</code></li>
                </ul>
                <p>
                    Example usage:
                </p>
                <pre><code class="language-php">&lt;?php

declare(strict_types=1);

namespace App\Form;

use Aeon\Symfony\AeonBundle\Validator\Constraints\Holiday;
use Aeon\Symfony\AeonBundle\Validator\Constraints\NotHoliday;
use Symfony\Component\Form\AbstractType;
use Symfony\Component\Form\Extension\Core\Type\SubmitType;
use Symfony\Component\Form\FormBuilderInterface;
use Symfony\Component\OptionsResolver\OptionsResolver;

final class AeonFormType extends AbstractType
{
    public function buildForm(FormBuilderInterface $builder, array $options) : void
    {
        $builder->add('datetime', AeonDateTimeType::class, [
            'widget' => 'single_text',
            'input' => 'string',
            'data' => $options['calendar']->now()->format('Y-m-d H:i:s'),
        ]);

        $builder->add('submit', SubmitType::class);
    }

    public function configureOptions(OptionsResolver $resolver) : void
    {
        parent::configureOptions($resolver);

        $resolver->setRequired('calendar');
        $resolver->setAllowedTypes('calendar', Calendar::class);
    }
}</code></pre>
            </section>
            <section>
                <h3>How to set current date in Symfony Form field</h3>
                <p>
                    The bast practice is to always take the current date and time from one Calendar instance
                    registered in Symfony Service Container, because it can be also mocked in the tests making them predictable and stable.
                    In order to use Calendar in the form first it needs to be configured as an required option.
                </p>
                <pre><code class="language-php">&lt;?php

declare(strict_types=1);

namespace App\Form;

use Aeon\Symfony\AeonBundle\Validator\Constraints\Holiday;
use Aeon\Symfony\AeonBundle\Validator\Constraints\NotHoliday;
use Symfony\Component\Form\AbstractType;
use Symfony\Component\Form\Extension\Core\Type\SubmitType;
use Symfony\Component\Form\FormBuilderInterface;
use Symfony\Component\OptionsResolver\OptionsResolver;

final class AeonFormType extends AbstractType
{
    public function buildForm(FormBuilderInterface $builder, array $options) : void
    {
        $builder->add('holiday', AeonDayType::class, [
            'constraints' => [new Holiday(['countryCode' => 'US'])]
        ]);

        $builder->add('not_holiday', AeonDayType::class, [
            'constraints' => [new NotHoliday(['countryCode' => 'US'])]
        ]);

        $builder->add('submit', SubmitType::class);
    }
}</code></pre>
                <p>
                    Later when creating form this option is required:
                </p>
                <pre><code class="language-php">&lt;?php

declare(strict_types=1);

namespace App\Controller;

use Aeon\Calendar\Gregorian\Calendar;
use App\Form\AeonFormType;
use Symfony\Bundle\FrameworkBundle\Controller\AbstractController;
use Symfony\Component\HttpFoundation\Request;
use Symfony\Component\HttpFoundation\Response;
use Symfony\Component\Routing\Annotation\Route;

class AeonCalendarController extends AbstractController
{
    private Calendar $calendar;

    public function __construct(Calendar $calendar)
    {
        $this->calendar = $calendar;
    }

    /**
     * @Route("/aeon/form", name="aeon_form")
     */
    public function form(Request $request) : Response
    {
        $form = $this->createForm(AeonFormType::class, null, ['calendar' => $this->calendar]);

        $form->handleRequest($request);

        if ($form->isSubmitted() && $form->isValid()) {

        }

        return $this->render('aeon_calendar/form.html.twig', [
            'form' => $form->createView(),
        ]);
    }
}</code></pre>
            </section>
            <section>
                <h3>How to compare two Symfony DateTime fields</h3>
                <p>
                    In order to compare two symfony fields when not using object as a form model in order
                    to compare one field with another we need to use constraint <code>propertyPath</code> option
                    and select other field through current field <code>parent</code> (form)
                </p>
                <pre><code class="language-php">&lt;?php

declare(strict_types=1);

namespace App\Form;

use Aeon\Symfony\AeonBundle\Validator\Constraints\Holiday;
use Aeon\Symfony\AeonBundle\Validator\Constraints\NotHoliday;
use Symfony\Component\Form\AbstractType;
use Symfony\Component\Form\Extension\Core\Type\SubmitType;
use Symfony\Component\Form\FormBuilderInterface;
use Symfony\Component\OptionsResolver\OptionsResolver;

final class AeonFormType extends AbstractType
{
    public function buildForm(FormBuilderInterface $builder, array $options) : void
    {
        $builder->add('datetime_compare_1', AeonDateTimeType::class, [
            'widget' => 'single_text',
            'input' => 'string',
            'data' => $options['calendar']->now()->sub(TimeUnit::second())->format('Y-m-d H:i:s'),
            'constraints' => [
                new Before(['propertyPath' => 'parent.all[datetime_compare_2].data']),
            ],
        ]);
        $builder->add('datetime_compare_2', AeonDateTimeType::class, [
            'widget' => 'single_text',
            'input' => 'string',
            'data' => $options['calendar']->now()->format('Y-m-d H:i:s'),
        ]);

        $builder->add('submit', SubmitType::class);
    }
}</code></pre>
            </section>
            <section>
                <h3 id="yasumi">How to use <a href="https://github.com/azuyalabs/yasumi" target="_blank">Yasumi</a> holidays provider</h3>
                <p>
                    By default symfony bundle registers <code>calendar.holidays.factory.google</code> service as a holiday provide however Yasumi is much more reliable and precise.
                    It's also recommended holidays provider, in order to use it first install:
                </p>
                <p>
                    <code>composer require aeon-php/calendar-holidays-yasumi</code>
                </p>
                <p>
                    And then configure the bundle
                </p>
                <pre><code class="language-yaml"># config/packages/aeon.yaml

aeon:
  calendar_holidays_factory_service: 'calendar.holidays.factory.yasumi'</code></pre>
            </section>
        </article>
        <aside class="col-md-3">
            <div class="sticky">
                <section class="text-center mb-2">
                    <a href="https://github.com/aeon-php/website/blob/1.x/templates/documentation/symfony_bundle.html.twig" class="btn btn-secondary p-1" target="_blank"><i class="fab fa-github"></i> Edit this page</a>
                </section>
                <ul id="toc" class="nav flex-column toc">
                    <li class="nav-item">
                        <a data-scroll class="nav-link" href="#installation">Installation</a>
                    </li>
                    <li class="nav-item">
                        <a data-scroll class="nav-link" href="#configuration">Configuration</a>
                    </li>
                    <li class="nav-item">
                        <a data-scroll class="nav-link" href="#aeon-symfony-form-types">Aeon Symfony Form Types</a>
                    </li>
                    <li class="nav-item">
                        <a data-scroll class="nav-link" href="#aeon-symfony-validators">Aeon Symfony Validators</a>
                    </li>
                    <li class="nav-item">
                        <a data-scroll class="nav-link" href="#current-time">Current Time</a>
                    </li>
                    <li class="nav-item">
                        <a data-scroll class="nav-link" href="#testing">Testing</a>
                    </li>
                    <li class="nav-item">
                        <a data-scroll class="nav-link" href="#yasumi">Yasumi</a>
                    </li>
                </ul>
            </div>
        </aside>
    </div>
            </article>
        </div>
    </div>
</section>

<!-- footer -->
<footer class="bg-dark">
    <div class="container">
        <div class="row gutter-3">
            <div class="col-12 col-md-2">
                <a href="/"></a>
            </div>
            <div class="col-12 col-md-8 text-white">
                <p class="mb-4">
                    Aeon is a set of libraries that makes easier to work with PHP Date & Time in elegant Object Oriented way.
                </p>
                <div class="row">
                    <div class="col-6">
                        <ul class="list-group list-group-minimal">
                            <li class="list-group-item"><a href="https://packagist.org/packages/aeon-php/calendar" target="_blank">aeon-php/calendar</a></li>
                            <li class="list-group-item"><a href="https://packagist.org/packages/aeon-php/calendar-doctrine" target="_blank">aeon-php/calendar-doctrine</a></li>
                            <li class="list-group-item"><a href="https://packagist.org/packages/aeon-php/calendar-holidays" target="_blank">aeon-php/calendar-holidays</a></li>
                            <li class="list-group-item"><a href="https://packagist.org/packages/aeon-php/calendar-holidays-yasumi" target="_blank">aeon-php/calendar-holidays-yasumi</a></li>
                            <li class="list-group-item"><a href="https://packagist.org/packages/aeon-php/cli" target="_blank">aeon-php/cli</a></li>
                        </ul>
                    </div>
                    <div class="col-6">
                        <ul class="list-group list-group-minimal">
                            <li class="list-group-item"><a href="https://packagist.org/packages/aeon-php/business-hours" target="_blank">aeon-php/business-hours</a></li>
                            <li class="list-group-item"><a href="https://packagist.org/packages/aeon-php/process" target="_blank">aeon-php/process</a></li>
                            <li class="list-group-item"><a href="https://packagist.org/packages/aeon-php/retry" target="_blank">aeon-php/retry</a></li>
                            <li class="list-group-item"><a href="https://packagist.org/packages/aeon-php/calendar-twig" target="_blank">aeon-php/calendar-twig</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</footer>
<!-- / footer -->

<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.0/highlight.min.js"></script>
<!-- and it's easy to individually load additional languages -->
<script charset="UTF-8"
        src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.0/languages/php.min.js"></script>
<script src="/dist/js/app.js"></script>
</body>
</html>